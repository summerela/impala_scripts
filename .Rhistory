as.data.frame(ranges(vars))
colnames(as.data.frame(ranges(vars)))
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start,
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), "_"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = names(genes)[subjectHits(match)],
#gene_id =
stringsAsFactors=F)
cbind(match.df, ranges(vars))
length(vars)
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), "_"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = names(genes)[subjectHits(match)],
#gene_id =
stringsAsFactors=F)
head(match.df)
grep("103-00060-02", vcf_pass, value=TRUE)
grep("103-00060-02", vcf_pass$sample_id, value=TRUE)
vcf_pass[grep("103-00060-02", vcf_pass$sample_id, value=TRUE),]
head(vcf_pass)
head(match.df)
head(vars)
head(vcf_pass$sample_id)
vars = with(vcf_pass, GRanges(seqnames=vcf_pass$chromosome,
ranges=IRanges(vcf_pass$pos, width=1,
names=paste(vcf_pass$sample_id, ":",vcf_pass$ref, ">", vcf_pass$alt, sep="")),rsID=vcf_pass$id, filter=vcf_pass$filter, qual=vcf_pass$qual, sample_id=vcf_pass$sample_id))
genes = with(ens, GRanges(seqnames=ens$chromosome,
ranges=IRanges(ens$start, ens$stop,names=ens$gene_id),
feature=ens$feature, trans_id=ens$transcript_id, gene_id=ens$gene_id, gene_name=ens$gene_name, trans_name=ens$transcript_name, exon=ens$exon_id))
##find variants that fall in gene regions
match = findOverlaps(vars, genes)
head(match)
head(vars)
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2]))
head(variant)
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = names(genes)[subjectHits(match)],
#gene_id =
stringsAsFactors=F)
head(match.df)
head(vars)
grep("103-00060-02", vcf_pass$sample_id)
grep("^103-00060-02$", vcf_pass$sample_id)
vcf_pass[grep("^103-00060-02$", vcf_pass$sample_id),]
head(vcf_pass)
head(match.df)
head(match.df, 50)
dim(match.df)
head(match.df)
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = names(genes)[subjectHits(match)],
#gene_id =
stringsAsFactors=F)
head(match.df)
head(vars)
head(genes)
head(names(genes))
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_id = names(genes)[subjectHits(match)],
gene_name = mcols(genes)$gene_id[subjectHits(match)],
stringsAsFactors=F)
head(match.df)
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_id = names(genes)[subjectHits(match)],
gene_name = mcols(genes)$gene_name[subjectHits(match)],
stringsAsFactors=F)
head(match.df)
head(genes)
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = mcols(genes)$gene_name[subjectHits(match)],
gene_id = names(genes)[subjectHits(match)],
trans_name = mcols(genes)$trans_name[subjectHits(match)],
trans_id = mcols(genes)$trans_id[subjectHits(match)],
exon_id = mcols(genes)$exon[subjectHits(match)],
feature = mcols(genes)$feature[subjectHits(match)],
stringsAsFactors=F)
head(match.df)
str(match.df$featur)
str(match.df$feature)
mathc.df == ens_results
match.df == ens_results
dim(match.df)
dim(ensembl_results)
dim(ens_results)
colnames(ens_results)
colnames(match.df)
ens_results$variant = paste(ens_results$ref, ">", ens_results$alt, sep="")
head(ens_results)
ens_results$variant = paste(ens_results$vcf_ref, ">", ens_results$vcf_alt, sep="")
head(ens_results)
ens.df = ens_results[,c(ens_results$vcf_ref)]
head(ens.df)
ens.df = ens_results[,c(-ens_results$vcf_ref)]
ens.df = ens_results[,-c(ens_results$vcf_ref)]
head(ens.df)
colnames(ens_results)
ens.df = ens_results[,-c(4)]
colnames(ens.df)
ens.df = ens_results[,-c(4,5,7,8,16)]
colnames(ens.df)
head(vars)
colnames(match.df)
colnames(ens_results)
ens.df = ens_results[,c(1,2,3,17,6,10,11,13,14,15)]
colnames(ens.df) = colnames(match.df)
dim(ens.df)
dim(match.df)
ens.df = ens_results[,c(1,2,3,17,6,10,11,13,14,15,9)]
colnames(ens.df) = colnames(match.df)
ens.df == match.df
dim(ens.df)
dim(match.df)
library(compare)
compare(match.df, ens.df, equal=TRUE)
compare(match.df, ens.df, equal=TRUE, ignore.case=TRUE)
compare(match.df, ens.df, equal=TRUE, allowAll=TRUE)
head(match.df)
head(ens.df)
?orderby
?order
?sort
?order
?sort
ens.df = ens.df[with(ens.df, order(sample_id)]
ens.df = ens.df[with(ens.df, order(sample_id)),]
head(ens.df)
match.df = match.df[with(match.df, order(sample(id))),]
match.df = match.df[with(match.df, order(sample_id)),]
head(match.df)
compare(match.df, ens.df, equal=TRUE, allowAll=TRUE)
diff(match.df, ens.df)
match.df = ens.df
match.df == ens.df
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = mcols(genes)$gene_name[subjectHits(match)],
gene_id = names(genes)[subjectHits(match)],
trans_name = mcols(genes)$trans_name[subjectHits(match)],
trans_id = mcols(genes)$trans_id[subjectHits(match)],
exon_id = mcols(genes)$exon[subjectHits(match)],
feature = mcols(genes)$feature[subjectHits(match)],
stringsAsFactors=F)
match.df = match.df[with(match.df, order(sample_id)),]
match.df == ens.df
lapply(match.df, class)
lapply(ens.df, class)
classy.df = data.frame(matches = lapply(match.df, class),
ens_results=lapply(ens.df, class))
classy.df
matches = lapply(match.df, class)
ens_results=lapply(ens.df, class))
ens_results=lapply(ens.df, class)
matches
head(ens.df)
lapply(match.df, class)
lapply(ens.df, class)
ens.df$sample_id = as.character(ens.df$sample_id)
head(ens.df)
match.df$chrom = as.character(match.df$chrom)
ens.df$chrom = as.character(ens.df$chrom)
ens.df$rsID = as.character(ens.df$rsID)
head(ens.df$rsID)
head(ens.df)
ens.df$rsId = as.character(ens.df$rsId)
head(ens.df)
match.df$gene_name = as.character(match.df$gene_name)
lapply(match.df, as.character)
match.df = lapply(match.df, as.character)
head(match.df)
match.df = data.frame(lapply(match.df, as.character))
head(match.df)
ens.df = data.frame(lapply(ens.df, as.character))
head(ens.df)
lapply(match.df, class)
lapply(ens.df, class)
match.df == ens.df
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = mcols(genes)$gene_name[subjectHits(match)],
gene_id = names(genes)[subjectHits(match)],
trans_name = mcols(genes)$trans_name[subjectHits(match)],
trans_id = mcols(genes)$trans_id[subjectHits(match)],
exon_id = mcols(genes)$exon[subjectHits(match)],
feature = mcols(genes)$feature[subjectHits(match)],
stringsAsFactors=F)
#add variant column to impala results
ens_results$variant = paste(ens_results$vcf_ref, ">", ens_results$vcf_alt, sep="")
#coerce to same structure as match.df for comparison
ens.df = ens_results[,c(1,2,3,17,6,10,11,13,14,15,9)]
colnames(ens.df) = colnames(match.df)
head(ens.df)
ens.df = ens_results[c(1,2,3,17,6,10,11,13,14,15,9)]
colnames(ens.df) = colnames(match.df)
head(ens.df)
ens = sqlFetch(conn, "p7dev.ensembl_test")
ens = sqlFetch(conn, "p7dev.ensembl_test")
##subset for only vcf rows that passed filtering
vcf_pass = vcf[which(vcf$filter == "PASS"),]
#create GRanges objects for comparison
vars = with(vcf_pass, GRanges(seqnames=vcf_pass$chromosome,
ranges=IRanges(vcf_pass$pos, width=1,
names=paste(vcf_pass$sample_id, ":",vcf_pass$ref, ">", vcf_pass$alt, sep="")),rsID=vcf_pass$id, filter=vcf_pass$filter, qual=vcf_pass$qual, sample_id=vcf_pass$sample_id))
genes = with(ens, GRanges(seqnames=ens$chromosome,
ranges=IRanges(ens$start, ens$stop,names=ens$gene_id),
feature=ens$feature, trans_id=ens$transcript_id, gene_id=ens$gene_id, gene_name=ens$gene_name, trans_name=ens$transcript_name, exon=ens$exon_id))
##find variants that fall in gene regions
match = findOverlaps(vars, genes)
##turn results into a data frame
match.df = data.frame(sample_id = as.character(mcols(vars)$sample_id)[queryHits(match)],
chrom = seqnames(vars)[queryHits(match)],
pos = as.data.frame(ranges(vars))$start[queryHits(match)],
variant = as.character(lapply(strsplit(as.character(names(vars)[queryHits(match)]), ":"), function(x) x[2])),
rsId = as.character(mcols(vars)$rsID)[queryHits(match)],
gene_name = mcols(genes)$gene_name[subjectHits(match)],
gene_id = names(genes)[subjectHits(match)],
trans_name = mcols(genes)$trans_name[subjectHits(match)],
trans_id = mcols(genes)$trans_id[subjectHits(match)],
exon_id = mcols(genes)$exon[subjectHits(match)],
feature = mcols(genes)$feature[subjectHits(match)],
stringsAsFactors=F)
#450 rows, same as impala query
head(match.df)
dim(match.df)
#add variant column to impala results
ens_results$variant = paste(ens_results$vcf_ref, ">", ens_results$vcf_alt, sep="")
#coerce to same structure as match.df for comparison
ens.df = ens_results[c(1,2,3,17,6,10,11,13,14,15,9)]
colnames(ens.df) = colnames(match.df)
head(ens.df)
head(ens_results)
ens_results = read.csv("./queries/testing//query_result_ensembl.csv")
ens_results = read.csv("./queries/testing/query_result_ensembl.csv")
setwd("~/GitHub/impala_annot/impala_scripts/queries/testing")
ens_results = read.csv("./queries/testing/query_result_ensembl.csv")
ens_results = read.csv("./queries/testing/query_result_ensembl.csv.csv")
ens_results = read.csv("./query_result_ensembl.csv.csv")
ens_results$variant = paste(ens_results$vcf_ref, ">", ens_results$vcf_alt, sep="")
#coerce to same structure as match.df for comparison
ens.df = ens_results[c(1,2,3,17,6,10,11,13,14,15,9)]
colnames(ens.df) = colnames(match.df)
ens.df = ens.df[with(ens.df, order(sample_id)),]
match.df = match.df[with(match.df, order(sample_id)),]
lapply(match.df, class)
lapply(ens.df, class)
ens.df$sample_id = as.character(ens.df$sample_id)
lapply(match.df, class)
head(ens.df)
match.df$chrom = as.character(match.df$chrom)
lapply(match.df, class)
head(match.df)
ens.df$chrom = as.character(ens.df$chrom)
head(ens.df)
ens.df$rsId = as.character(ens.df$rsId)
head(ens.df)
ens.df$gene_id = as.character(ens.df$gene_id)
head(ens.df)
match.df == ens.df
lapply(match.df, class)
lapply(ens.df, class)
match.df$gene_name = as.character(match.df$gene_name)
head(match.df)
ens.df$gene_name = as.character(ens.df$gene_name)
head(ens.df)
match.df$trans_name = as.character(match.df$trans_name)
ens.df$trans_name = as.character(ens.df$trans_name)
match.df$trans_id = as.character(match.df$trans_id)
ens.df$trans_id = as.character(ens.df$trans_id)
match.df$exon_id = as.character(match.df$exon_id)
ens.df$exon_id = as.character(ens.df$exon_id)
match.df$feature = as.character(match.df$feature)
ens.df$feature = as.character(ens.df$feature)
head(match.df)
head(ens.df)
lapply(match.df, class)
lapply(ens.df, class)
match.df == ens.df
which(match.df != ens.df)
match.df[which(match.df != ens.df),]
ens.df[which(match.df != ens.df),]
na.omit(ens.df[which(match.df != ens.df),])
rownames(match.df)
rownames(match.df)= NULL
rownames(ens.df) = NULL
na.omit(ens.df[which(match.df != ens.df),])
all.equal(match.df, ens.df)
which(match.df != ens.df)
na.omit(match.df[which(match.df != ens.df),])
all.equal(match.df, ens.df)
na.omit(all.equal(match.df, ens.df))
which(match.df != ens.df, arr.ind=TRUE)
head(which(match.df != ens.df, arr.ind=TRUE))
match.df[,268]
match.df[268]
match.df[268,]
ens.df[268,]
head(which(match.df != ens.df, arr.ind=TRUE))
match.df[272,]
ens.df[272,]
ens.df = ens.df[with(ens.df, order(sample_id, chrom, pos, variant, gene_name)),]
match.df = match.df[with(match.df, order(sample_id, chrom, pos, variant, gene_name)),]
lapply(match.df, class)
lapply(ens.df, class)
head(which(match.df != ens.df, arr.ind=TRUE))
match.df[6,]
ens.df[6,]
which(match.df != ens.df, arr.ind=TRUE)
match.df[6,]
ens.df[6,]
ens.df = ens.df[with(ens.df, order(sample_id, chrom, pos, variant, gene_name, gene_id, trans_name, trans_id, exon_id, feature)),]
match.df = match.df[with(match.df, order(sample_id, chrom, pos, variant, gene_name, trans_name, trans_id, exon_id, feature)),]
which(match.df != ens.df, arr.ind=TRUE)
match.df == ens.df
head(match.df)
head(ens.df)
ens.df = gsub("NULL", "NA", ens.df$rsId)
head(ens.df)
ens.df = ens_results[c(1,2,3,17,6,10,11,13,14,15,9)]
colnames(ens.df) = colnames(match.df)
ens.df = ens.df[with(ens.df, order(sample_id, chrom, pos, variant, gene_name, gene_id, trans_name, trans_id, exon_id, feature)),]
ens.df$sample_id = as.character(ens.df$sample_id)
match.df$chrom = as.character(match.df$chrom)
ens.df$chrom = as.character(ens.df$chrom)
ens.df$rsId = as.character(ens.df$rsId)
ens.df$gene_id = as.character(ens.df$gene_id)
match.df$gene_name = as.character(match.df$gene_name)
ens.df$gene_name = as.character(ens.df$gene_name)
match.df$trans_name = as.character(match.df$trans_name)
ens.df$trans_name = as.character(ens.df$trans_name)
match.df$trans_id = as.character(match.df$trans_id)
ens.df$trans_id = as.character(ens.df$trans_id)
match.df$exon_id = as.character(match.df$exon_id)
ens.df$exon_id = as.character(ens.df$exon_id)
match.df$feature = as.character(match.df$feature)
ens.df$feature = as.character(ens.df$feature)
rownames(match.df)= NULL
rownames(ens.df) = NULL
lapply(match.df, class)
lapply(ens.df, class)
head(ens.df)
ens.df$rsId = gsub("NULL", "NA", ens.df$rsId)
head(ens.df)
which(match.df != ens.df, arr.ind=TRUE)
match.df == ens.df
str(ens_results$feature)
str(match.df$feature)
levels(match.df$feature)
unique(match.df$feature)
conn <- odbcConnect("Impala DSN")
match = suppressWarnings(findOverlaps(vars, genes))
head(match)
head(unique(match.df$gene_name))
random(unique(match.df$gene_name), 5)
sample(unique(match.df$gene_name), 5)
test.df = ens.df
class(ens.df)
lapply(ens.df, class)
lapply(test.df, class)
source('~/.active-rstudio-document', echo=TRUE)
coerce(test.df)
lapply(test.df, coerce)
to_char = function(col){
if (class(col) != "INT"){
col = as.character(col)
}
}
test.df = ens.df
lapply(test.df, to_char)
testing = lapply(test.df, to_char)
head(testing)
testing = data.frame(lapply(test.df, to_char))
head(testing)
dim(testing)
lapply(testing, class)
lapply(ens.df, class)
to_char = function(col){
if (class(col) != "integer"){
col = as.character(col)
}
}
test.df = ens.df
test.df = ens.dflapply(.df, class)
testing = data.frame(lapply(test.df, to_char))
to_char = function(x){
if (class(x) != "integer"){
lapply(x, as.character)
}
}
test.df = ens.df
testing = data.frame(lapply(test.df, to_char))
testing = to_char(test.df)
head(testing)
testing = data.frame(to_char(test.df))
head(testing)
lapply(testing, class)
head(test.df)
test.df = ens.df
i <- sapply(test.df, is.factor)
bob[i] <- lapply(test.df[i], as.character)
test.df[i] <- lapply(test.df[i], as.character)
head(test.df)
lapply(test.df, class)
j = sapply(match.df, is.factor)
match.df[j] = lapply(match.df[i], as.character)
head(match.df)
lapply(class, match.df)
lapply(match.df, class)
rownames(match.df)= NULL
rownames(ens.df) = NULL
ens.df$rsId = gsub("NULL", "NA", ens.df$rsId)
which(match.df != ens.df, arr.ind=TRUE)
sample(unique(match.df$gene_name), 5)
rand_genes = sample(unique(match.df$gene_name), 5)
rand_genes
rand_genes
match.df[which(match.df$gene_name %in% rand_genes),]
match.df[match(match.df$gene_name, rand_genes),]
match.df[(rand_genes %in% match.df$gene_name),]
match.df[(match.df$gene_name %in% rand_genes),]
dim(match.df[(match.df$gene_name %in% rand_genes),])
match.df[(match.df$gene_name %in% rand_genes),]
rand_genes
dim(rand_match)
rand_match = match.df[(match.df$gene_name %in% rand_genes),]
dim(rand_match)
rand_match
ens.df
match_imp_results = ens.df[(ens.df$gene_name %in% rand_genes),]
dim(match_imp_results)
match_imp_results
which(rand_match != match_imp_results, arr.ind=TRUE)
rand_genes
rand_gene_impala = read.table("./rand_gene_query.xls")
rand_gene_impala = read.table("./rand_gene_query.xls", sep="\t")
rand_gene_impala = read.table("./rand_gene_query.txt, sep="\t")
rand_gene_impala = read.table("./rand_gene_query.txt", sep="\t")
head(rand_gene_impala)
rand_gene_impala = read.table("./rand_gene_query.txt", sep="\t", header=TRUE)
head(rand_gene_impala)
colnames(rand_gene_impala) = colnames(match_imp_results)
rownames(rand_gene_impala) = NULL
head(rand_gene_impala)
which(rand_match != rand_gene_impala, arr.ind=TRUE)
dim(rand_match)
dim(rand_gene_impala)
rand_gene_impala = read.table("./rand_gene_query.txt", sep="\t", header=TRUE)
rand_gene_impala$variant = paste(rand_gene_impala$ref, ">", rand_gene_impala$alt, sep="")
head(rand_gene_impala)
rand_gene_impala.test = rand_gene_impala[,c(1:3,13,6:12)]
dim(rand_gene_impala.test)
dim(rand_genes)
dim(rand_match)
rand_gene_impala = rand_gene_impala[,c(1:3,13,6:12)]
colnames(rand_gene_impala) = colnames(match_imp_results)
rownames(rand_gene_impala) = NULL
head(rand_gene_impala)
which(rand_match != rand_gene_impala, arr.ind=TRUE)
lapply(rand_gene_impala, class)
k = sapply(rand_gene_impala, is.factor)
rand_gene_impala[k] = lapply(rand_gene_impala[k], as.character)
which(rand_match != rand_gene_impala, arr.ind=TRUE)
match_imp_results
rand_gene_impala = rand_gene_impala[with(rand_gene_impala, order(sample_id, chrom, pos, variant, gene_name, trans_name, trans_id, exon_id, feature)),]
which(rand_match != rand_gene_impala, arr.ind=TRUE)
lapply(rand_gene_impala, class)
head(vcf_pass)
head(match.df)
vcf_pass[!which(match.df$sample_id %in% vcf_pass$sample_id)]
class(vcf_pass$sample_id)
vcf_pass[!which(as.character(match.df$sample_id) %in% vcf_pass$sample_id)]
class(match.df$sample_id)
vcf_pass[!which(match.df$sample_id %in% as.character(vcf_pass$sample_id)),]
vcf_pass[!which(as.character(vcf_pass$sample_id) %in% match.df$sample_id),]
head(match.df$sample_id)
head(vcf_pass$sample_id)
head(as.character(vcf_pass$sample_id))
head(as.character(match.df$sample_id))
vcf_pass[!which(as.character(vcf_pass$sample_id) %in% as.character(match.df$sample_id)),]
vcf_pass[which(as.character(vcf_pass$sample_id) %in% as.character(match.df$sample_id)),]
head(rownames(vcf_pass))
rand_genes
which(rand_match != match_imp_results, arr.ind=TRUE)
dim(rand_match)
dim(match_imp_results)
which(rand_match != match_imp_results, arr.ind=TRUE)
